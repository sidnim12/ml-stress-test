<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Baseline Report</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
  <div class="container">

    <div class="topbar">
      <div class="brand">
        <div class="badge">RT</div>
        <div>
          <h1>Baseline Evaluation Report</h1>
          <p>Task-aware performance metrics Â· Foundation for robustness testing</p>
        </div>
      </div>

      <!-- Theme toggle (NEW) -->
      <button id="themeToggle" class="theme-btn" type="button" aria-label="Toggle theme" title="Toggle theme">
        ðŸŒ™
      </button>

      <div class="pill">Task: {{ results.task }}</div>
    </div>

    <div class="card">
      <div class="card-inner">

        <!-- KPI SECTION -->
        <div class="kpis">
          <div class="kpi">
            <p class="k">Rows</p>
            <p class="v">{{ results.rows }}</p>
          </div>
          <div class="kpi">
            <p class="k">Columns</p>
            <p class="v">{{ results.cols }}</p>
          </div>
          <div class="kpi">
            <p class="k">Target</p>
            <p class="v">{{ results.target }}</p>
          </div>
        </div>

        {% if results.dropped_target_nan_rows and results.dropped_target_nan_rows > 0 %}
          <div class="hr"></div>
          <p class="note">
            <strong>Data integrity note:</strong>
            Dropped <strong>{{ results.dropped_target_nan_rows }}</strong> rows due to missing target values.
            Target values are never imputed to preserve evaluation correctness.
          </p>
        {% endif %}

        <div class="hr"></div>

        <!-- BASELINE METRICS -->
        <p class="h2">Baseline Metrics</p>
        <p class="sub">
          These metrics define the modelâ€™s reference performance under clean data conditions.
          All future stress experiments will track the same metrics to measure
          stability, degradation rate, and structural breakpoints.
        </p>

        <table class="table">
          <thead>
            <tr>
              <th>Metric</th>
              <th>Value</th>
              <th>Notes</th>
            </tr>
          </thead>
          <tbody>
            {% for k, v in results.baseline.items() %}
              <tr>
                <td><code class="metric-key">{{ k }}</code></td>
                <td>
                  {% if v is none %}
                    N/A
                  {% else %}
                    {% if v != v %}
                      NaN
                    {% else %}
                      {{ v }}
                    {% endif %}
                  {% endif %}
                </td>
                <td class="metric-notes">
                  {% if k in ['roc_auc','pr_auc','log_loss'] %}
                    Probability-based metric (requires predict_proba; task-specific constraints apply)
                  {% elif k in ['accuracy','balanced_accuracy','f1','precision','recall'] %}
                    Label-based classification metric
                  {% elif k in ['rmse','mae','r2','mape_percent','smape_percent'] %}
                    Regression performance metric
                  {% else %}
                    â€”
                  {% endif %}
                </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>

        <div class="hr"></div>

        <!-- NEXT PHASES -->
        <p class="h2">Next Phases</p>
        <ul class="note">
          <li><strong>Phase 2:</strong> Noise Injection Stress Test â€” metric degradation curves & breakpoint detection.</li>
          <li><strong>Phase 3:</strong> Feature Drop Sensitivity â€” dependency and fragility analysis.</li>
          <li><strong>Phase 4:</strong> Missingness Shock â€” tolerance threshold evaluation.</li>
          <li><strong>Phase 5:</strong> Covariate Shift Simulation â€” distribution drift resilience testing.</li>
        </ul>

        <div class="hr"></div>

        <a class="btn" href="/" style="display:inline-block; text-align:center;">
          Run Another Dataset
        </a>

      </div>
    </div>

    <!-- FOOTER -->
    <div class="footer">
      <div>Baseline Engine Â· Task-Aware Metric Registry Â· Safe Computation Layer</div>
      <div>Next Milestone: Stability Curves Â· Breakpoint Detection Â· Robustness Index</div>
    </div>

  </div>

  <!-- Theme toggle script (NEW) -->
  <script>
    (function () {
      const html = document.documentElement;
      const btn = document.getElementById("themeToggle");

      function applyTheme(theme) {
        html.setAttribute("data-theme", theme);
        btn.textContent = (theme === "dark") ? "â˜€ï¸" : "ðŸŒ™";
        btn.setAttribute("aria-label", theme === "dark" ? "Switch to light theme" : "Switch to dark theme");
        btn.setAttribute("title", theme === "dark" ? "Light theme" : "Dark theme");
      }

      const saved = localStorage.getItem("theme");
      const systemPrefersDark =
        window.matchMedia && window.matchMedia("(prefers-color-scheme: dark)").matches;

      applyTheme(saved || (systemPrefersDark ? "dark" : "light"));

      btn.addEventListener("click", () => {
        const current = html.getAttribute("data-theme") || "light";
        const next = (current === "dark") ? "light" : "dark";
        localStorage.setItem("theme", next);
        applyTheme(next);
      });
    })();
  </script>
</body>
</html>